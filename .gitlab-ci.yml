stages:
    - build
    - deploy

build:
    stage: build
    image: ubuntu:focal
    before_script:
        - export DEBIAN_FRONTEND=noninteractive
        - ln -fs /usr/share/zoneinfo/Asia/Tehran /etc/localtime
        - apt-get install -y tzdata
        - dpkg-reconfigure --frontend noninteractive tzdata
        - apt-get -qq update && apt-get install -y texlive-fonts-recommended texlive-latex-extra texlive-fonts-extra dvipng texlive-latex-recommended texlive-full
    script:
        - mkdir _build
        - pdflatex -output-directory _build ./tex/ParhamNikdouzCV.tex
        - git config --local user.name "Parham Nikdouz"
        - git config --local user.email "pnikdouz@gmail.com"
        - git tag "$(date +'%Y_%m_%d_%H_%M_%S')-$(git log --format=%h -1)"
    artifacts:
        paths:
            - ./_build/ParhamNikdouzCV.pdf
        expire_in: 30 min
    only:
        - master

# deploy:
#     stage: deploy
#     dependencies:
#         - build
#     script:
#         - cp ./_build/ParhamNikdouzCV.pdf .
#         - cp ./_build/ParhamNikdouzCV.pdf /root
#         - echo "Uploaded to server!"
#     tags:
#         - shell_executor
#     only:
#         - master
